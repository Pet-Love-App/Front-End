name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

concurrency:
  group: pr-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  # ==================== PR ä¿¡æ¯ ====================
  pr-info:
    name: ðŸ“‹ PR Info
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“ Check PR size
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const total = pr.additions + pr.deletions;

            console.log(`ðŸ“Š PR Size: +${pr.additions} -${pr.deletions} (${total} total)`);

            // åªæ˜¯è­¦å‘Šï¼Œä¸é˜»æ­¢
            if (total > 1000) {
              core.warning(`å¤§åž‹ PR (${total} è¡Œ)ã€‚å»ºè®®æ‹†åˆ†ä¸ºæ›´å°çš„ PRã€‚`);
            }

  # ==================== å˜æ›´æ£€æµ‹ ====================
  change-detection:
    name: ðŸ” Change Detection
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ” Detect changes
        id: changes
        uses: dorny/paths-filter@v3
        with:
          filters: |
            src:
              - 'src/**'
            config:
              - '*.config.*'
              - 'package.json'
              - 'tsconfig.json'

      - name: ðŸ“ Log changes
        run: |
          echo "## ðŸ“Š Change Detection" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Source code changed: ${{ steps.changes.outputs.src }}" >> $GITHUB_STEP_SUMMARY
          echo "- Config changed: ${{ steps.changes.outputs.config }}" >> $GITHUB_STEP_SUMMARY
