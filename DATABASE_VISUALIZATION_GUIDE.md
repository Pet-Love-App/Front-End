# 📊 数据库可视化工具使用指南

## 🎯 功能概述

本应用提供了强大的本地 SQLite 数据库管理和可视化功能，包括：

1. **收藏卡片管理** - 存储和管理猫粮信息
2. **添加剂可视化** - 动态气泡图展示添加剂成分
3. **营养成分分析** - 饼状图展示营养配比
4. **高赞评论展示** - 卡片式布局显示用户评价
5. **数据库管理** - 查看、导出、增删数据

---

## 🚀 快速开始

### 1. 添加测试数据

在**收藏页面**点击 "➕ 添加2条测试数据" 按钮：

```
收藏页面 → 点击 "➕ 添加2条测试数据"
```

这将自动添加两条完整的猫粮数据，包括：
- ✅ 基本信息（名称、品牌、价格、评分等）
- ✅ 6个添加剂（牛磺酸、维生素E、DHA等）
- ✅ 8个营养成分（蛋白质、脂肪、纤维等）
- ✅ 3条高赞评论

### 2. 查看详情报告

点击任意收藏卡片进入详情页：

```
收藏卡片 → 点击进入详情 → 查看完整报告
```

---

## 🎨 可视化功能详解

### 📍 添加剂气泡图

**特点**：
- 🎈 每个添加剂对应一个彩色气泡
- 🌈 橙黄色调，随机大小和颜色
- 💫 轻微碰撞动画效果
- 🔘 气泡上显示添加剂名称
- 👆 点击气泡查看详细信息

**使用方法**：
1. 在详情页找到"添加剂成分"区域
2. 点击任意气泡
3. 弹窗显示详细信息：
   - 添加剂名称
   - 类型（营养强化剂、维生素等）
   - 安全等级
   - 详细说明

**视觉效果**：
```
    🟠 牛磺酸
🟡 维生素E    🟠 DHA
    🟡 益生菌
🟠 叶酸    🟡 生物素
```

### 📊 营养成分饼图

**特点**：
- 🥧 清晰的饼状图展示
- 🎨 多彩配色方案
- 📈 百分比显示
- 📋 详细数值列表

**数据包括**：
- 粗蛋白：38%
- 粗脂肪：18%
- 粗纤维：3.5%
- 粗灰分：8%
- 水分：10%
- 其他微量元素

### 💬 高赞评论卡片

**特点**：
- 👤 用户头像（首字母显示）
- 👍 点赞数显示
- ⭐ 评分星级
- 📅 评论时间
- 📝 评论内容

**显示规则**：
- 最多显示3条高赞评论
- 按点赞数降序排列
- 展示真实用户反馈

---

## 📱 使用场景示例

### 场景1：查看猫粮营养配比

```
1. 进入收藏页面
2. 点击"皇家猫粮 K36"卡片
3. 滚动到"营养成分分析"
4. 查看饼图和详细数值
```

### 场景2：了解添加剂安全性

```
1. 进入猫粮详情页
2. 找到"添加剂成分"区域
3. 点击"牛磺酸"气泡
4. 查看弹窗信息：
   - 类型：营养强化剂
   - 安全等级：安全 ✅
   - 说明：猫咪必需的氨基酸
```

### 场景3：参考其他用户评价

```
1. 进入猫粮详情页
2. 滚动到"高赞评论"区域
3. 查看用户真实反馈
4. 参考点赞数和评分
```

---

## 🛠️ 数据库管理工具

### 查看数据库路径

在数据库管理页面点击"路径"按钮，显示：
```
file:///Users/你的用户名/Library/Developer/CoreSimulator/Devices/[设备ID]/data/Containers/Data/Application/[应用ID]/Documents/SQLite/petlove.db
```

### 导出数据库文件

1. 点击"导出"按钮
2. 选择分享方式（AirDrop、文件、邮件等）
3. 数据库文件可用其他工具打开

**推荐工具**：
- 📱 手机端：直接在应用内查看
- 💻 电脑端：DB Browser for SQLite
- 🌐 在线：SQLite Viewer

### 查看表结构

数据库包含4张表：

1. **cat_food_collect** - 猫粮收藏表（主表）
2. **cat_food_additives** - 添加剂表
3. **cat_food_nutrition** - 营养成分表
4. **cat_food_comments** - 高赞评论表

---

## 💡 数据结构说明

### 添加剂数据格式

```typescript
{
  additiveName: '牛磺酸',
  additiveType: '营养强化剂',
  safetyLevel: '安全',
  description: '猫咪必需的氨基酸，有助于视力和心脏健康'
}
```

### 营养成分数据格式

```typescript
{
  nutrientName: '粗蛋白',
  percentage: 38,
  unit: '%',
  category: '主要成分'
}
```

### 评论数据格式

```typescript
{
  userName: '橘猫铲屎官',
  userAvatar: 'https://...',
  content: '我家橘猫吃了三个月...',
  likeCount: 1288,
  commentTime: 1234567890,
  rating: 5
}
```

---

## 🎯 最佳实践

### 添加自定义数据

修改 `index.tsx` 中的 `addTestData` 函数：

```typescript
const addTestData = async () => {
  const { saveCatFoodDetail } = require('@/src/database/detailService');
  
  await saveCatFoodDetail({
    // 基本信息
    id: Date.now().toString(),
    name: '你的猫粮名称',
    // ... 其他字段
    
    // 添加剂
    additives: [
      { 
        additiveName: '添加剂名称',
        additiveType: '类型',
        safetyLevel: '安全',
        description: '描述'
      }
    ],
    
    // 营养成分
    nutrition: [
      { 
        nutrientName: '营养名称',
        percentage: 38,
        unit: '%',
        category: '分类'
      }
    ],
    
    // 评论
    topComments: [
      {
        userName: '用户名',
        content: '评论内容',
        likeCount: 999,
        rating: 5
      }
    ]
  });
};
```

### 自定义气泡颜色

在 `[id].tsx` 中修改颜色数组：

```typescript
const colors = [
  '#FFB347', // 浅橙
  '#FFA500', // 橙色
  '#FF8C42', // 深橙
  '#FFD700', // 金色
  '#FDB45C', // 黄橙
  '#FF9966', // 珊瑚橙
  '#FFAA33'  // 琥珀色
];
```

### 调整营养饼图颜色

```typescript
const colors = [
  '#FF6384', // 粉红
  '#36A2EB', // 蓝色
  '#FFCE56', // 黄色
  '#4BC0C0', // 青色
  '#9966FF', // 紫色
  '#FF9F40', // 橙色
];
```

---

## 🔧 故障排除

### 问题1：气泡不显示

**原因**：没有添加剂数据  
**解决**：点击"添加测试数据"按钮

### 问题2：饼图显示空白

**原因**：营养成分数据为空  
**解决**：确保测试数据包含 nutrition 字段

### 问题3：评论不显示

**原因**：topComments 数据为空  
**解决**：检查数据是否包含评论信息

### 问题4：数据库文件找不到

**原因**：
- iOS 模拟器：文件在沙盒内
- 真实设备：需要通过应用内导出

**解决**：
- 使用应用内的"导出"功能
- 或在数据库管理页面查看

---

## 📚 技术栈

- **数据库**：SQLite (expo-sqlite)
- **图表库**：react-native-chart-kit
- **动画**：react-native-reanimated
- **UI组件**：React Native 原生组件

---

## 🎉 总结

本应用提供了完整的数据库可视化解决方案：

✅ **易用性** - 一键添加测试数据  
✅ **美观性** - 炫酷的气泡和图表动画  
✅ **实用性** - 真实的营养分析和用户评价  
✅ **可扩展性** - 易于添加自定义数据

开始使用吧！🚀
